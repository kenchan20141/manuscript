<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中文寫作</title>
    <!-- 樣式部分保持不變 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>
    <!-- HTML 結構保持不變 -->
    <div id="music-panel">
        <select id="music-select">
            <option value="">選擇音樂</option>
            <option value="b5d5OmmUlPc">宮崎駿</option>
            <option value="2gIAmAZhWzM">放鬆</option>
        </select>
        <button id="play-btn">▶️</button>
        <button id="pause-btn">⏸️</button>
        <input type="range" id="progress-bar" min="0" max="100" value="0">
    </div>
    <div id="youtube-player"></div>

    <script>
        // 其他腳本保持不變，直到音樂播放控制部分

        // 音樂播放控制
        let player;
        let currentVideoId = '';
        let isPlaying = false;
        let progressInterval;

        function onYouTubeIframeAPIReady() {
            // 初始化播放器
            player = new YT.Player('youtube-player', {
                height: '0',
                width: '0',
                playerVars: {
                    'autoplay': 0, // 不自動播放
                    'controls': 0, // 隱藏控制條
                    'disablekb': 1, // 禁用鍵盤控制
                    'enablejsapi': 1, // 啟用 JS API
                    'iv_load_policy': 3, // 隱藏影片註解
                    'modestbranding': 1, // 減少 YouTube 品牌顯示
                    'rel': 0, // 不顯示相關影片
                    'showinfo': 0 // 隱藏影片資訊
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });

            // 監聽音樂選擇
            document.getElementById('music-select').addEventListener('change', function() {
                const videoId = this.value;
                if (videoId) {
                    currentVideoId = videoId;
                    player.loadVideoById(videoId); // 載入選定的影片
                }
            });

            // 播放按鈕
            document.getElementById('play-btn').addEventListener('click', function() {
                if (player && currentVideoId) {
                    player.playVideo(); // 播放影片
                } else {
                    alert('請先選擇音樂！');
                }
            });

            // 暫停按鈕
            document.getElementById('pause-btn').addEventListener('click', function() {
                if (player) {
                    player.pauseVideo(); // 暫停影片
                }
            });

            // 進度條控制
            document.getElementById('progress-bar').addEventListener('input', function() {
                if (player) {
                    const time = (this.value / 100) * player.getDuration();
                    player.seekTo(time, true); // 跳轉到指定時間
                }
            });
        }

        function onPlayerReady(event) {
            // 播放器準備好時不自動播放，等待用戶操作
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                isPlaying = true;
                startProgressUpdate(); // 開始更新進度條
            } else {
                isPlaying = false;
                stopProgressUpdate(); // 停止更新進度條
            }
        }

        function startProgressUpdate() {
            stopProgressUpdate();
            progressInterval = setInterval(function() {
                if (player && isPlaying) {
                    const currentTime = player.getCurrentTime();
                    const duration = player.getDuration();
                    if (duration > 0) {
                        const progress = (currentTime / duration) * 100;
                        document.getElementById('progress-bar').value = progress;
                    }
                }
            }, 1000);
        }

        function stopProgressUpdate() {
            if (progressInterval) {
                clearInterval(progressInterval);
                progressInterval = null;
            }
        }

        // 其他腳本保持不變
    </script>
</body>
</html>
