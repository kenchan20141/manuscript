<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中文寫作</title>
    <!-- 引入 Font Awesome 圖示庫 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* 原有樣式保持不變，僅添加音樂面板樣式 */
        #music-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #f0f0f0;
            padding: 10px;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: transform 0.3s ease-in-out;
        }
        #music-panel.hidden {
            transform: translateY(100%);
        }
        #music-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 600px;
            margin: 0 auto;
        }
        #music-controls button {
            background-color: transparent;
            border: none;
            cursor: pointer;
            font-size: 24px;
            padding: 5px;
        }
        #progress-bar {
            width: 50%;
            cursor: pointer;
        }
        #music-select {
            width: 100px;
            padding: 5px;
        }
        #music-player {
            display: none;
        }
        #toggle-panel-btn {
            position: absolute;
            top: -30px;
            right: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
        }
        @media (max-width: 600px) {
            #music-controls {
                flex-wrap: wrap;
            }
            #progress-bar {
                width: 100%;
                margin: 10px 0;
            }
            #music-select {
                width: 80px;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- 引入 YouTube IFrame Player API -->
    <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>
    <!-- 原有內容保持不變 -->
    <div id="controls">...</div>
    <div id="manuscript"></div>
    <div id="word-count">字數：0</div>
    <div id="progress-overlay">...</div>
    <div id="ask-panel">...</div>

    <!-- 音樂面板 -->
    <div id="music-panel">
        <button id="toggle-panel-btn">↓</button>
        <div id="music-controls">
            <button id="play-btn"><i class="fas fa-play"></i></button>
            <button id="pause-btn"><i class="fas fa-pause"></i></button>
            <input type="range" id="progress-bar" value="0" min="0" max="100">
            <select id="music-select">
                <option value="miyazaki">宮崎駿</option>
                <option value="relax">放鬆</option>
            </select>
        </div>
        <div id="music-player">
            <div id="youtube-player"></div>
        </div>
    </div>

    <script>
        // 原有 JavaScript 保持不變，這裡僅添加音樂面板相關腳本
        // ... (原有腳本內容)

        // 音樂面板腳本
        const musicPanel = document.getElementById('music-panel');
        const playBtn = document.getElementById('play-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const progressBar = document.getElementById('progress-bar');
        const musicSelect = document.getElementById('music-select');
        const togglePanelBtn = document.getElementById('toggle-panel-btn');
        let player;
        let currentMusic = 'miyazaki';
        let isPlaying = false;

        // 音樂 ID
        const musicIds = {
            miyazaki: 'b5d5OmmUlPc',
            relax: '2gIAmAZhWzM'
        };

        // 初始化 YouTube 播放器
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtube-player', {
                height: '0',
                width: '0',
                videoId: musicIds[currentMusic],
                playerVars: {
                    'autoplay': 0,
                    'controls': 0,
                    'showinfo': 0,
                    'rel': 0,
                    'iv_load_policy': 3,
                    'modestbranding': 1
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onAdStart': skipAd
                }
            });
        }

        function onPlayerReady(event) {
            // 播放器準備好後可進行操作
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                isPlaying = true;
                updateProgressBar();
            } else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.ENDED) {
                isPlaying = false;
            }
        }

        // 自動跳過廣告（嘗試檢測並跳轉）
        function skipAd() {
            if (player && player.getAdState && player.getAdState() === 1) {
                player.seekTo(player.getDuration()); // 嘗試跳到結束
            }
        }

        // 播放音樂
        function playMusic() {
            if (player && currentMusic) {
                player.loadVideoById(musicIds[currentMusic]);
                player.playVideo();
                isPlaying = true;
            }
        }

        // 暫停音樂
        function pauseMusic() {
            if (player) {
                player.pauseVideo();
                isPlaying = false;
            }
        }

        // 更新進度條
        function updateProgressBar() {
            if (isPlaying && player) {
                const duration = player.getDuration();
                const currentTime = player.getCurrentTime();
                progressBar.value = (currentTime / duration) * 100;
                requestAnimationFrame(updateProgressBar);
            }
        }

        // 選擇音樂
        musicSelect.addEventListener('change', function() {
            currentMusic = this.value;
            if (isPlaying) {
                playMusic();
            }
        });

        // 播放按鈕
        playBtn.addEventListener('click', playMusic);

        // 暫停按鈕
        pauseBtn.addEventListener('click', pauseMusic);

        // 進度條拖動
        progressBar.addEventListener('input', function() {
            if (player) {
                const seekToTime = (this.value / 100) * player.getDuration();
                player.seekTo(seekToTime, true);
            }
        });

        // 切換面板顯示/隱藏
        togglePanelBtn.addEventListener('click', function() {
            musicPanel.classList.toggle('hidden');
            this.textContent = musicPanel.classList.contains('hidden') ? '↑' : '↓';
        });

        // 初始化時隱藏面板
        musicPanel.classList.add('hidden');
    </script>
</body>
</html>
